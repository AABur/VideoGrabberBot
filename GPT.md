Задание - решение

1. Требования (Prerequisites)
	•	Обновите DSM на DS423+ до последней версии через Панель управления → Обновление и восстановление.
	•	Убедитесь, что в настройках системы включён виртуализационный модуль (обычно включён по умолчанию).
	•	Проверьте архитектуру процессора NAS (DS423+ использует ARM64) и убедитесь, что ваш Docker-образ поддерживает платформу linux/arm64/v8. При необходимости пересоберите образ командой:

docker buildx build \
  --platform linux/arm64/v8 \
  -t ваш-репозиторий/ваше-приложение:latest \
  .



2. Подготовка NAS для Docker (Synology NAS Preparation)
	1.	Откройте Центр пакетов, найдите и установите пакет Docker.
	2.	В Панель управления → Общие папки создайте папку, например docker, и внутри неё подпапку your-app для хранения данных приложения.
	3.	В Панель управления → Сеть → Сетевой интерфейс назначьте NAS статический IP-адрес или зарезервируйте его через DHCP.

3. Установка и настройка Docker (Docker Installation and Setup)
	1.	После установки откройте приложение Docker в интерфейсе DSM.
	2.	(Опционально) Чтобы использовать docker-compose в командной строке:
	•	Включите SSH в Панель управления → Терминал и SNMP.
	•	Подключитесь по SSH и установите Python3 и docker-compose:

sudo synopkg install Python3
pip3 install docker-compose



4. Развёртывание приложения (Application Deployment)

Через графический интерфейс (GUI)
	1.	В приложении Docker перейдите на вкладку Реестр, введите имя образа (например, ваш-репозиторий/ваше-приложение) и нажмите Загрузить.
	2.	После загрузки перейдите на вкладку Образы, выберите нужный образ и нажмите Запустить.
	3.	В мастере настройки контейнера укажите:
	•	Имя контейнера (например, your-app).
	•	В разделе Объёмы нажмите Добавить, укажите:
	•	Папка на хосте: /volume1/docker/your-app
	•	Папка в контейнере: /app/data
	•	В Настройках порта укажите сопоставление, например 8000 (NAS) → 80 (контейнер).
	•	В Переменные среды (Environment) добавьте необходимые переменные, например:

DB_HOST=db
DB_USER=myuser
DB_PASSWORD=mypassword


	•	Нажмите Применить и ОК.

Через командную строку (CLI)

# Скачиваем образ
docker pull ваш-репозиторий/ваше-приложение:latest

# Запускаем контейнер
docker run -d \
  --name your-app \
  -v /volume1/docker/your-app:/app/data \
  -p 8000:80 \
  -e DB_HOST=db \
  -e DB_USER=myuser \
  -e DB_PASSWORD=mypassword \
  ваш-репозиторий/ваше-приложение:latest

5. Управление постоянными данными (Persistent Data Management)
	•	Данные приложения сохраняются в папке /volume1/docker/your-app на NAS и монтируются в контейнер.
	•	Для разных сервисов можно создать отдельные подпапки (например /db, /uploads) и указать их монтирование через -v.

6. Сетевая конфигурация и порты (Networking and Port Configuration)
	•	В настройках портов Docker GUI убедитесь, что выбранные порты не конфликтуют с другими сервисами.
	•	При необходимости настройте пересылку портов на вашем маршрутизаторе: внешний порт → IP NAS:8000.
	•	Для безопасного внешнего доступа используйте обратный прокси (Reverse Proxy) в Панель управления → Порталы приложений → Обратный прокси.

7. Запуск и управление контейнером (Starting and Managing the Container)
	•	В Docker GUI на вкладке Контейнеры выберите your-app и используйте кнопки Запустить, Остановить, Перезапустить.
	•	Для просмотра логов по SSH выполните:

docker logs -f your-app



8. Устранение неполадок (Troubleshooting)
	•	Контейнер сразу завершает работу: проверьте логи docker logs на ошибки конфигурации или отсутствие переменных среды.
	•	Порт уже занят: убедитесь, что другой сервис не использует тот же порт на NAS.
	•	Проблемы с правами доступа: в Панель управления → Общие папки → Права доступа проверьте, что пользователи docker или admin имеют необходимые права.
	•	Образ не запускается на ARM64: пересоберите образ с поддержкой платформы linux/arm64/v8 через docker buildx.
	•	Отсутствует веб-интерфейс: проверьте настройки обратного прокси и сопоставления портов.